<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Picker Component</title>
    <link rel="stylesheet" href="../design/design_tokens.css">
    <link rel="stylesheet" href="../design/components.css">
    <link rel="stylesheet" href="../design/layout.css">
    <style>
        /* Color Picker Component Styles */
        .color-picker-advanced {
            width: 280px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .color-picker-gradient {
            position: relative;
            width: 100%;
            height: 160px;
            background: linear-gradient(to right, #fff, var(--current-hue, #ff0000));
            cursor: crosshair;
        }

        .color-picker-gradient::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, transparent, #000);
        }

        .color-picker-cursor {
            position: absolute;
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-radius: 50%;
            box-shadow: 0 0 0 1px #000, inset 0 0 0 1px #000;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .color-picker-hue {
            position: relative;
            height: 20px;
            margin: var(--space-3);
            background: linear-gradient(to right,
                #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000);
            border-radius: var(--radius-default);
            cursor: pointer;
        }

        .color-picker-hue-cursor {
            position: absolute;
            top: -2px;
            width: 8px;
            height: 24px;
            background: #fff;
            border: 1px solid #000;
            border-radius: var(--radius-sm);
            transform: translateX(-50%);
            box-shadow: var(--shadow-sm);
        }

        .color-picker-alpha {
            position: relative;
            height: 20px;
            margin: 0 var(--space-3) var(--space-3);
            background-image:
                linear-gradient(45deg, #ccc 25%, transparent 25%),
                linear-gradient(-45deg, #ccc 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #ccc 75%),
                linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 10px 10px;
            background-position: 0 0, 0 5px, 5px -5px, -5px 0px;
            border-radius: var(--radius-default);
            overflow: hidden;
            cursor: pointer;
        }

        .color-picker-alpha-gradient {
            position: absolute;
            inset: 0;
            background: linear-gradient(to right, transparent, var(--current-color, #ff0000));
        }

        .color-picker-alpha-cursor {
            position: absolute;
            top: -2px;
            width: 8px;
            height: 24px;
            background: #fff;
            border: 1px solid #000;
            border-radius: var(--radius-sm);
            transform: translateX(-50%);
            box-shadow: var(--shadow-sm);
        }

        .color-picker-preview-row {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: 0 var(--space-3) var(--space-3);
        }

        .color-picker-preview {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-default);
            background-image:
                linear-gradient(45deg, #ccc 25%, transparent 25%),
                linear-gradient(-45deg, #ccc 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #ccc 75%),
                linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 8px 8px;
            overflow: hidden;
        }

        .color-picker-preview-color {
            width: 100%;
            height: 100%;
        }

        .color-picker-inputs {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .color-picker-input-row {
            display: flex;
            gap: var(--space-2);
        }

        .color-picker-input-group {
            flex: 1;
        }

        .color-picker-input-group label {
            display: block;
            font-size: var(--text-xs);
            color: var(--text-muted);
            margin-bottom: var(--space-0-5);
        }

        .color-picker-input-group input {
            width: 100%;
            padding: var(--space-1) var(--space-2);
            font-size: var(--text-sm);
            font-family: var(--font-mono);
        }

        .color-picker-hex-input {
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .color-picker-hex-input span {
            color: var(--text-muted);
        }

        .color-picker-hex-input input {
            flex: 1;
        }

        .color-picker-mode-tabs {
            display: flex;
            padding: var(--space-2) var(--space-3);
            gap: var(--space-1);
            border-bottom: 1px solid var(--border-default);
        }

        .color-picker-mode-tab {
            padding: var(--space-1) var(--space-2);
            font-size: var(--text-xs);
            font-weight: var(--font-medium);
            color: var(--text-secondary);
            background: transparent;
            border: none;
            border-radius: var(--radius-default);
            cursor: pointer;
        }

        .color-picker-mode-tab:hover {
            background: var(--bg-hover);
        }

        .color-picker-mode-tab.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .color-picker-presets {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: var(--space-1);
            padding: var(--space-3);
            border-top: 1px solid var(--border-default);
        }

        .color-picker-preset {
            width: 100%;
            aspect-ratio: 1;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-muted);
            cursor: pointer;
            transition: var(--transition-transform);
        }

        .color-picker-preset:hover {
            transform: scale(1.1);
            border-color: var(--border-emphasis);
        }

        /* Eyedropper button */
        .eyedropper-btn {
            margin-left: auto;
        }

        /* Demo styles */
        .demo-container {
            padding: var(--space-6);
            max-width: 800px;
            margin: 0 auto;
        }

        .demo-section {
            margin-bottom: var(--space-6);
        }

        .demo-row {
            display: flex;
            gap: var(--space-6);
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1 class="text-2xl font-semibold mb-6">Color Picker Component</h1>

        <div class="demo-row">
            <!-- Full Color Picker -->
            <div class="demo-section">
                <h3 class="text-md font-semibold mb-4">Full Color Picker</h3>
                <div class="color-picker-advanced" id="color-picker">
                    <div class="color-picker-gradient" id="gradient-area">
                        <div class="color-picker-cursor" id="gradient-cursor"></div>
                    </div>

                    <div class="color-picker-hue" id="hue-slider">
                        <div class="color-picker-hue-cursor" id="hue-cursor"></div>
                    </div>

                    <div class="color-picker-alpha" id="alpha-slider">
                        <div class="color-picker-alpha-gradient"></div>
                        <div class="color-picker-alpha-cursor" id="alpha-cursor"></div>
                    </div>

                    <div class="color-picker-preview-row">
                        <div class="color-picker-preview">
                            <div class="color-picker-preview-color" id="preview-color"></div>
                        </div>
                        <div class="color-picker-inputs">
                            <div class="color-picker-hex-input">
                                <span>#</span>
                                <input type="text" id="hex-input" value="ff0000" maxlength="8">
                                <button class="btn btn-icon btn-ghost btn-xs eyedropper-btn" title="Eyedropper">
                                    <span data-icon="search"></span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="color-picker-mode-tabs">
                        <button class="color-picker-mode-tab active" data-mode="rgb">RGB</button>
                        <button class="color-picker-mode-tab" data-mode="hsv">HSV</button>
                        <button class="color-picker-mode-tab" data-mode="hsl">HSL</button>
                    </div>

                    <div class="color-picker-preview-row" id="color-values">
                        <div class="color-picker-inputs">
                            <div class="color-picker-input-row">
                                <div class="color-picker-input-group">
                                    <label>R</label>
                                    <input type="number" min="0" max="255" value="255" id="r-input">
                                </div>
                                <div class="color-picker-input-group">
                                    <label>G</label>
                                    <input type="number" min="0" max="255" value="0" id="g-input">
                                </div>
                                <div class="color-picker-input-group">
                                    <label>B</label>
                                    <input type="number" min="0" max="255" value="0" id="b-input">
                                </div>
                                <div class="color-picker-input-group">
                                    <label>A</label>
                                    <input type="number" min="0" max="100" value="100" id="a-input">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="color-picker-presets" id="presets"></div>
                </div>
            </div>

            <!-- Output Display -->
            <div class="demo-section">
                <h3 class="text-md font-semibold mb-4">Output</h3>
                <div class="card">
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">HEX</label>
                            <input type="text" id="output-hex" readonly class="font-mono">
                        </div>
                        <div class="form-group">
                            <label class="form-label">RGB</label>
                            <input type="text" id="output-rgb" readonly class="font-mono">
                        </div>
                        <div class="form-group">
                            <label class="form-label">HSL</label>
                            <input type="text" id="output-hsl" readonly class="font-mono">
                        </div>
                        <div class="form-group">
                            <label class="form-label">RGBA</label>
                            <input type="text" id="output-rgba" readonly class="font-mono">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../design/design_tokens.js"></script>
    <script src="../design/icons.js"></script>
    <script>
    /**
     * Advanced Color Picker
     */
    class ColorPickerAdvanced {
        constructor(container) {
            this.container = typeof container === 'string' ? document.querySelector(container) : container;

            // Color state
            this.hsv = { h: 0, s: 100, v: 100 };
            this.alpha = 1;

            // DOM elements
            this.gradientArea = this.container.querySelector('#gradient-area');
            this.gradientCursor = this.container.querySelector('#gradient-cursor');
            this.hueSlider = this.container.querySelector('#hue-slider');
            this.hueCursor = this.container.querySelector('#hue-cursor');
            this.alphaSlider = this.container.querySelector('#alpha-slider');
            this.alphaCursor = this.container.querySelector('#alpha-cursor');
            this.previewColor = this.container.querySelector('#preview-color');
            this.hexInput = this.container.querySelector('#hex-input');
            this.presetsContainer = this.container.querySelector('#presets');

            this._init();
        }

        _init() {
            this._setupGradientArea();
            this._setupHueSlider();
            this._setupAlphaSlider();
            this._setupInputs();
            this._setupPresets();
            this._setupModeTabs();
            this._update();
        }

        _setupGradientArea() {
            let isDragging = false;

            const updateFromMouse = (e) => {
                const rect = this.gradientArea.getBoundingClientRect();
                const x = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
                const y = Math.max(0, Math.min(1, (e.clientY - rect.top) / rect.height));

                this.hsv.s = x * 100;
                this.hsv.v = (1 - y) * 100;
                this._update();
            };

            this.gradientArea.addEventListener('mousedown', (e) => {
                isDragging = true;
                updateFromMouse(e);
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) updateFromMouse(e);
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }

        _setupHueSlider() {
            let isDragging = false;

            const updateFromMouse = (e) => {
                const rect = this.hueSlider.getBoundingClientRect();
                const x = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
                this.hsv.h = x * 360;
                this._update();
            };

            this.hueSlider.addEventListener('mousedown', (e) => {
                isDragging = true;
                updateFromMouse(e);
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) updateFromMouse(e);
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }

        _setupAlphaSlider() {
            let isDragging = false;

            const updateFromMouse = (e) => {
                const rect = this.alphaSlider.getBoundingClientRect();
                const x = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
                this.alpha = x;
                this._update();
            };

            this.alphaSlider.addEventListener('mousedown', (e) => {
                isDragging = true;
                updateFromMouse(e);
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) updateFromMouse(e);
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }

        _setupInputs() {
            const rInput = this.container.querySelector('#r-input');
            const gInput = this.container.querySelector('#g-input');
            const bInput = this.container.querySelector('#b-input');
            const aInput = this.container.querySelector('#a-input');

            const updateFromRGB = () => {
                const r = parseInt(rInput.value) || 0;
                const g = parseInt(gInput.value) || 0;
                const b = parseInt(bInput.value) || 0;
                this.setRGB(r, g, b);
            };

            [rInput, gInput, bInput].forEach(input => {
                input.addEventListener('change', updateFromRGB);
            });

            aInput.addEventListener('change', () => {
                this.alpha = (parseInt(aInput.value) || 0) / 100;
                this._update();
            });

            this.hexInput.addEventListener('change', () => {
                this.setHex(this.hexInput.value);
            });
        }

        _setupPresets() {
            const presetColors = [
                '#ff0000', '#ff4500', '#ffa500', '#ffd700', '#ffff00',
                '#9acd32', '#00ff00', '#00fa9a', '#00ffff', '#00bfff',
                '#0000ff', '#8a2be2', '#9400d3', '#ff00ff', '#ff1493',
                '#ffffff', '#c0c0c0', '#808080', '#404040', '#000000'
            ];

            presetColors.forEach(color => {
                const preset = document.createElement('div');
                preset.className = 'color-picker-preset';
                preset.style.background = color;
                preset.addEventListener('click', () => this.setHex(color));
                this.presetsContainer.appendChild(preset);
            });
        }

        _setupModeTabs() {
            const tabs = this.container.querySelectorAll('.color-picker-mode-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    // Could switch input mode here
                });
            });
        }

        _update() {
            const rgb = this._hsvToRgb(this.hsv.h, this.hsv.s, this.hsv.v);
            const hex = this._rgbToHex(rgb.r, rgb.g, rgb.b);
            const hsl = this._rgbToHsl(rgb.r, rgb.g, rgb.b);
            const hueColor = this._hsvToRgb(this.hsv.h, 100, 100);

            // Update gradient background
            this.gradientArea.style.setProperty('--current-hue', `rgb(${hueColor.r}, ${hueColor.g}, ${hueColor.b})`);

            // Update cursors
            this.gradientCursor.style.left = `${this.hsv.s}%`;
            this.gradientCursor.style.top = `${100 - this.hsv.v}%`;
            this.hueCursor.style.left = `${(this.hsv.h / 360) * 100}%`;
            this.alphaCursor.style.left = `${this.alpha * 100}%`;

            // Update alpha gradient
            const alphaGradient = this.alphaSlider.querySelector('.color-picker-alpha-gradient');
            alphaGradient.style.background = `linear-gradient(to right, transparent, rgb(${rgb.r}, ${rgb.g}, ${rgb.b}))`;

            // Update preview
            this.previewColor.style.background = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${this.alpha})`;

            // Update inputs
            this.hexInput.value = this.alpha < 1 ?
                hex + Math.round(this.alpha * 255).toString(16).padStart(2, '0') : hex;

            this.container.querySelector('#r-input').value = rgb.r;
            this.container.querySelector('#g-input').value = rgb.g;
            this.container.querySelector('#b-input').value = rgb.b;
            this.container.querySelector('#a-input').value = Math.round(this.alpha * 100);

            // Update outputs
            document.getElementById('output-hex').value = '#' + hex;
            document.getElementById('output-rgb').value = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
            document.getElementById('output-hsl').value = `hsl(${Math.round(hsl.h)}, ${Math.round(hsl.s)}%, ${Math.round(hsl.l)}%)`;
            document.getElementById('output-rgba').value = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${this.alpha.toFixed(2)})`;
        }

        setHex(hex) {
            hex = hex.replace('#', '');
            if (hex.length === 3) {
                hex = hex.split('').map(c => c + c).join('');
            }
            if (hex.length >= 6) {
                const r = parseInt(hex.substr(0, 2), 16);
                const g = parseInt(hex.substr(2, 2), 16);
                const b = parseInt(hex.substr(4, 2), 16);
                this.setRGB(r, g, b);

                if (hex.length === 8) {
                    this.alpha = parseInt(hex.substr(6, 2), 16) / 255;
                }
            }
        }

        setRGB(r, g, b) {
            const hsv = this._rgbToHsv(r, g, b);
            this.hsv = hsv;
            this._update();
        }

        _hsvToRgb(h, s, v) {
            s /= 100; v /= 100;
            const c = v * s;
            const x = c * (1 - Math.abs((h / 60) % 2 - 1));
            const m = v - c;
            let r, g, b;

            if (h < 60) { r = c; g = x; b = 0; }
            else if (h < 120) { r = x; g = c; b = 0; }
            else if (h < 180) { r = 0; g = c; b = x; }
            else if (h < 240) { r = 0; g = x; b = c; }
            else if (h < 300) { r = x; g = 0; b = c; }
            else { r = c; g = 0; b = x; }

            return {
                r: Math.round((r + m) * 255),
                g: Math.round((g + m) * 255),
                b: Math.round((b + m) * 255)
            };
        }

        _rgbToHsv(r, g, b) {
            r /= 255; g /= 255; b /= 255;
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const d = max - min;
            let h = 0;

            if (d !== 0) {
                if (max === r) h = ((g - b) / d) % 6;
                else if (max === g) h = (b - r) / d + 2;
                else h = (r - g) / d + 4;
                h *= 60;
                if (h < 0) h += 360;
            }

            return {
                h: h,
                s: max === 0 ? 0 : (d / max) * 100,
                v: max * 100
            };
        }

        _rgbToHex(r, g, b) {
            return [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
        }

        _rgbToHsl(r, g, b) {
            r /= 255; g /= 255; b /= 255;
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const l = (max + min) / 2;
            let h = 0, s = 0;

            if (max !== min) {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                if (max === r) h = ((g - b) / d + (g < b ? 6 : 0)) / 6;
                else if (max === g) h = ((b - r) / d + 2) / 6;
                else h = ((r - g) / d + 4) / 6;
            }

            return { h: h * 360, s: s * 100, l: l * 100 };
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        NovaIcons.replaceIcons();
        new ColorPickerAdvanced('#color-picker');
    });
    </script>
</body>
</html>
