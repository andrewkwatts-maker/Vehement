<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matchmaking</title>
    <style>
        :root {
            --bg-primary: #0f0f1a;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --bg-card: #1e2746;
            --text-primary: #ffffff;
            --text-secondary: #8892b0;
            --accent-primary: #64ffda;
            --accent-secondary: #7c3aed;
            --accent-warning: #fbbf24;
            --accent-danger: #ef4444;
            --accent-success: #10b981;
            --border-color: #2d3748;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
        }

        h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .panel {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .panel h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-secondary);
        }

        /* Mode Selection */
        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .mode-card {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mode-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .mode-card.selected {
            border-color: var(--accent-primary);
            background: rgba(100, 255, 218, 0.1);
        }

        .mode-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .mode-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .mode-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Search UI */
        .search-container {
            display: none;
            text-align: center;
        }

        .search-container.active {
            display: block;
        }

        .spinner {
            width: 80px;
            height: 80px;
            margin: 20px auto;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .search-time {
            font-size: 48px;
            font-weight: 700;
            color: var(--accent-primary);
            margin: 20px 0;
        }

        .search-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }

        .search-stat {
            text-align: center;
        }

        .search-stat-value {
            font-size: 24px;
            font-weight: 600;
        }

        .search-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .mmr-range {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .mmr-bar {
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .mmr-fill {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .mmr-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Match Found */
        .match-found {
            display: none;
            text-align: center;
        }

        .match-found.active {
            display: block;
        }

        .match-icon {
            font-size: 64px;
            margin-bottom: 20px;
            animation: pulse 0.5s ease infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .match-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--accent-success);
        }

        .countdown {
            font-size: 64px;
            font-weight: 700;
            color: var(--accent-primary);
            margin: 20px 0;
        }

        .countdown.warning {
            color: var(--accent-warning);
        }

        .countdown.danger {
            color: var(--accent-danger);
            animation: shake 0.5s ease infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Lobby Browser */
        .lobby-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .lobby-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .lobby-item:hover {
            border-color: var(--accent-primary);
        }

        .lobby-item.selected {
            border-color: var(--accent-primary);
            background: rgba(100, 255, 218, 0.1);
        }

        .lobby-info {
            flex: 1;
        }

        .lobby-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .lobby-details {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .lobby-players {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .player-count {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .lobby-locked {
            color: var(--accent-warning);
        }

        /* Lobby View */
        .lobby-view {
            display: none;
        }

        .lobby-view.active {
            display: block;
        }

        .lobby-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .lobby-title {
            font-size: 24px;
            font-weight: 700;
        }

        .invite-code {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg-tertiary);
            padding: 10px 15px;
            border-radius: 8px;
        }

        .invite-code code {
            font-family: monospace;
            font-size: 18px;
            color: var(--accent-primary);
            letter-spacing: 2px;
        }

        .copy-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }

        .copy-btn:hover {
            color: var(--accent-primary);
        }

        .teams-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .team {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 15px;
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .team-name {
            font-weight: 600;
        }

        .team-1 .team-name {
            color: #3b82f6;
        }

        .team-2 .team-name {
            color: #ef4444;
        }

        .player-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: 600;
        }

        .player-name.host::after {
            content: 'HOST';
            margin-left: 8px;
            font-size: 10px;
            background: var(--accent-warning);
            color: #000;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .player-rating {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .ready-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-color);
        }

        .ready-indicator.ready {
            background: var(--accent-success);
        }

        .empty-slot {
            padding: 20px;
            text-align: center;
            color: var(--text-secondary);
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: var(--bg-primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(100, 255, 218, 0.3);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--accent-primary);
        }

        .btn-danger {
            background: var(--accent-danger);
            color: white;
        }

        .btn-success {
            background: var(--accent-success);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn-large {
            padding: 16px 48px;
            font-size: 18px;
        }

        /* Search Input */
        .search-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-input input {
            flex: 1;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .search-input input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .search-input input::placeholder {
            color: var(--text-secondary);
        }

        /* Settings Panel */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .setting-item label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .setting-item select {
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .setting-item select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        /* Ready Check Overlay */
        .ready-check-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .ready-check-overlay.active {
            display: flex;
        }

        .ready-check-content {
            text-align: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .ready-players {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .ready-player {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: 3px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .ready-player.accepted {
            border-color: var(--accent-success);
            background: rgba(16, 185, 129, 0.2);
        }

        .ready-player.declined {
            border-color: var(--accent-danger);
            background: rgba(239, 68, 68, 0.2);
        }

        /* Error Message */
        .error-message {
            display: none;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--accent-danger);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: var(--accent-danger);
        }

        .error-message.active {
            display: block;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Matchmaking</h1>

        <div class="error-message" id="errorMessage"></div>

        <!-- Mode Selection -->
        <div class="panel" id="modePanel">
            <h2>Select Game Mode</h2>
            <div class="mode-grid">
                <div class="mode-card selected" data-mode="quick">
                    <div class="mode-icon">&#9889;</div>
                    <div class="mode-name">Quick Match</div>
                    <div class="mode-desc">Find a match based on skill</div>
                </div>
                <div class="mode-card" data-mode="ranked">
                    <div class="mode-icon">&#127942;</div>
                    <div class="mode-name">Ranked</div>
                    <div class="mode-desc">Competitive matchmaking</div>
                </div>
                <div class="mode-card" data-mode="custom">
                    <div class="mode-icon">&#9881;</div>
                    <div class="mode-name">Custom Lobby</div>
                    <div class="mode-desc">Create or join a lobby</div>
                </div>
                <div class="mode-card" data-mode="browse">
                    <div class="mode-icon">&#128269;</div>
                    <div class="mode-name">Browse Games</div>
                    <div class="mode-desc">Find open lobbies</div>
                </div>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary btn-large" id="startMatchmaking">Find Match</button>
            </div>
        </div>

        <!-- Searching -->
        <div class="panel search-container" id="searchPanel">
            <div class="spinner"></div>
            <div class="search-time" id="searchTime">0:00</div>
            <p>Searching for players...</p>

            <div class="search-info">
                <div class="search-stat">
                    <div class="search-stat-value" id="playersInQueue">--</div>
                    <div class="search-stat-label">Players in queue</div>
                </div>
                <div class="search-stat">
                    <div class="search-stat-value" id="estimatedWait">--</div>
                    <div class="search-stat-label">Est. wait time</div>
                </div>
            </div>

            <div class="mmr-range">
                <p style="font-size: 12px; margin-bottom: 8px;">MMR Search Range</p>
                <div class="mmr-bar">
                    <div class="mmr-fill" id="mmrFill" style="width: 20%; left: 40%;"></div>
                </div>
                <div class="mmr-labels">
                    <span id="mmrMin">1400</span>
                    <span>Your MMR: <strong id="yourMmr">1500</strong></span>
                    <span id="mmrMax">1600</span>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-danger" id="cancelSearch">Cancel</button>
            </div>
        </div>

        <!-- Match Found -->
        <div class="panel match-found" id="matchFoundPanel">
            <div class="match-icon">&#127881;</div>
            <div class="match-title">Match Found!</div>
            <p style="color: var(--text-secondary);">Accept to join the game</p>
            <div class="countdown" id="acceptCountdown">10</div>
            <div class="btn-group">
                <button class="btn btn-success btn-large" id="acceptMatch">Accept</button>
                <button class="btn btn-danger" id="declineMatch">Decline</button>
            </div>
        </div>

        <!-- Lobby Browser -->
        <div class="panel hidden" id="browserPanel">
            <h2>Browse Lobbies</h2>
            <div class="search-input">
                <input type="text" placeholder="Search lobbies..." id="lobbySearch">
                <button class="btn btn-secondary" id="refreshLobbies">Refresh</button>
            </div>
            <div class="lobby-list" id="lobbyList">
                <!-- Lobbies populated dynamically -->
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" id="joinLobby" disabled>Join Selected</button>
                <button class="btn btn-secondary" id="createLobby">Create Lobby</button>
                <button class="btn btn-secondary" id="backFromBrowser">Back</button>
            </div>
        </div>

        <!-- Lobby View -->
        <div class="panel lobby-view" id="lobbyPanel">
            <div class="lobby-header">
                <div class="lobby-title" id="lobbyTitle">Game Lobby</div>
                <div class="invite-code">
                    <span>Code:</span>
                    <code id="lobbyCode">ABC123</code>
                    <button class="copy-btn" id="copyCode" title="Copy code">&#128203;</button>
                </div>
            </div>

            <div class="teams-container">
                <div class="team team-1">
                    <div class="team-header">
                        <span class="team-name">Team 1</span>
                        <span class="team-count">0/4</span>
                    </div>
                    <div class="team-players" id="team1Players">
                        <div class="empty-slot">Empty Slot</div>
                        <div class="empty-slot">Empty Slot</div>
                        <div class="empty-slot">Empty Slot</div>
                        <div class="empty-slot">Empty Slot</div>
                    </div>
                </div>
                <div class="team team-2">
                    <div class="team-header">
                        <span class="team-name">Team 2</span>
                        <span class="team-count">0/4</span>
                    </div>
                    <div class="team-players" id="team2Players">
                        <div class="empty-slot">Empty Slot</div>
                        <div class="empty-slot">Empty Slot</div>
                        <div class="empty-slot">Empty Slot</div>
                        <div class="empty-slot">Empty Slot</div>
                    </div>
                </div>
            </div>

            <div class="settings-grid" id="lobbySettings">
                <div class="setting-item">
                    <label>Map</label>
                    <select id="settingMap">
                        <option>Random</option>
                        <option>Valley</option>
                        <option>Desert</option>
                        <option>Islands</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label>Game Mode</label>
                    <select id="settingMode">
                        <option>Standard</option>
                        <option>Deathmatch</option>
                        <option>Capture</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label>Time Limit</label>
                    <select id="settingTime">
                        <option>No Limit</option>
                        <option>15 Minutes</option>
                        <option>30 Minutes</option>
                        <option>60 Minutes</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label>Starting Resources</label>
                    <select id="settingResources">
                        <option>Standard</option>
                        <option>High</option>
                        <option>Low</option>
                    </select>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-success btn-large" id="readyBtn">Ready</button>
                <button class="btn btn-primary" id="startGame" style="display: none;">Start Game</button>
                <button class="btn btn-danger" id="leaveLobby">Leave</button>
            </div>
        </div>

        <!-- Ready Check Overlay -->
        <div class="ready-check-overlay" id="readyCheckOverlay">
            <div class="ready-check-content">
                <h2>Ready Check</h2>
                <p style="color: var(--text-secondary);">Game is starting! Confirm you're ready.</p>
                <div class="countdown" id="readyCheckCountdown">10</div>
                <div class="ready-players" id="readyCheckPlayers">
                    <!-- Player indicators -->
                </div>
                <div class="btn-group">
                    <button class="btn btn-success btn-large" id="confirmReady">I'm Ready!</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        const state = {
            mode: 'quick',
            searching: false,
            searchStartTime: null,
            inLobby: false,
            isHost: false,
            isReady: false,
            players: [],
            selectedLobby: null,
            mmrRange: 100,
            baseMmr: 1500
        };

        // DOM elements
        const elements = {
            modePanel: document.getElementById('modePanel'),
            searchPanel: document.getElementById('searchPanel'),
            matchFoundPanel: document.getElementById('matchFoundPanel'),
            browserPanel: document.getElementById('browserPanel'),
            lobbyPanel: document.getElementById('lobbyPanel'),
            readyCheckOverlay: document.getElementById('readyCheckOverlay'),
            errorMessage: document.getElementById('errorMessage'),
            searchTime: document.getElementById('searchTime'),
            acceptCountdown: document.getElementById('acceptCountdown'),
            lobbyList: document.getElementById('lobbyList'),
            readyBtn: document.getElementById('readyBtn'),
            startGame: document.getElementById('startGame')
        };

        // Mode selection
        document.querySelectorAll('.mode-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                state.mode = card.dataset.mode;
            });
        });

        // Start matchmaking
        document.getElementById('startMatchmaking').addEventListener('click', () => {
            if (state.mode === 'browse') {
                showPanel('browserPanel');
                loadLobbies();
            } else if (state.mode === 'custom') {
                createLobby();
            } else {
                startSearch();
            }
        });

        // Cancel search
        document.getElementById('cancelSearch').addEventListener('click', () => {
            state.searching = false;
            showPanel('modePanel');
        });

        // Accept/decline match
        document.getElementById('acceptMatch').addEventListener('click', acceptMatch);
        document.getElementById('declineMatch').addEventListener('click', declineMatch);

        // Lobby browser
        document.getElementById('backFromBrowser').addEventListener('click', () => showPanel('modePanel'));
        document.getElementById('createLobby').addEventListener('click', createLobby);
        document.getElementById('joinLobby').addEventListener('click', joinSelectedLobby);
        document.getElementById('refreshLobbies').addEventListener('click', loadLobbies);

        // Lobby actions
        document.getElementById('readyBtn').addEventListener('click', toggleReady);
        document.getElementById('leaveLobby').addEventListener('click', leaveLobby);
        document.getElementById('copyCode').addEventListener('click', copyInviteCode);
        document.getElementById('confirmReady').addEventListener('click', confirmReadyCheck);

        function showPanel(panelId) {
            ['modePanel', 'searchPanel', 'matchFoundPanel', 'browserPanel', 'lobbyPanel'].forEach(id => {
                const panel = document.getElementById(id);
                if (id === panelId) {
                    panel.classList.remove('hidden');
                    panel.classList.add('active');
                } else {
                    panel.classList.add('hidden');
                    panel.classList.remove('active');
                }
            });
        }

        function startSearch() {
            state.searching = true;
            state.searchStartTime = Date.now();
            state.mmrRange = 100;
            showPanel('searchPanel');
            updateSearchUI();
        }

        function updateSearchUI() {
            if (!state.searching) return;

            const elapsed = Math.floor((Date.now() - state.searchStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            elements.searchTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            // Expand MMR range over time
            if (elapsed > 30 && state.mmrRange < 500) {
                state.mmrRange = Math.min(500, 100 + Math.floor(elapsed / 10) * 50);
            }

            document.getElementById('mmrMin').textContent = state.baseMmr - state.mmrRange;
            document.getElementById('mmrMax').textContent = state.baseMmr + state.mmrRange;

            const fillWidth = (state.mmrRange * 2) / 2000 * 100;
            const fillLeft = 50 - fillWidth / 2;
            document.getElementById('mmrFill').style.width = fillWidth + '%';
            document.getElementById('mmrFill').style.left = fillLeft + '%';

            document.getElementById('playersInQueue').textContent = Math.floor(Math.random() * 50) + 10;
            document.getElementById('estimatedWait').textContent = Math.floor(Math.random() * 30) + 's';

            setTimeout(updateSearchUI, 1000);
        }

        function showMatchFound() {
            showPanel('matchFoundPanel');
            let countdown = 10;

            const interval = setInterval(() => {
                countdown--;
                elements.acceptCountdown.textContent = countdown;

                if (countdown <= 3) {
                    elements.acceptCountdown.className = 'countdown danger';
                } else if (countdown <= 5) {
                    elements.acceptCountdown.className = 'countdown warning';
                }

                if (countdown <= 0) {
                    clearInterval(interval);
                    declineMatch();
                }
            }, 1000);

            elements.acceptCountdown.dataset.interval = interval;
        }

        function acceptMatch() {
            clearInterval(parseInt(elements.acceptCountdown.dataset.interval));
            joinLobby('match-lobby', 'Match Lobby');
        }

        function declineMatch() {
            clearInterval(parseInt(elements.acceptCountdown.dataset.interval));
            showPanel('modePanel');
        }

        function loadLobbies() {
            // Simulated lobby data
            const lobbies = [
                { id: '1', name: 'Casual Game', host: 'Player1', players: 3, max: 8, mode: 'Standard', locked: false },
                { id: '2', name: 'Pro Players Only', host: 'ProGamer', players: 6, max: 8, mode: 'Ranked', locked: true },
                { id: '3', name: 'Newbie Friendly', host: 'Helper', players: 2, max: 8, mode: 'Standard', locked: false },
                { id: '4', name: 'Tournament Practice', host: 'TeamLead', players: 7, max: 8, mode: 'Tournament', locked: false }
            ];

            elements.lobbyList.innerHTML = lobbies.map(lobby => `
                <div class="lobby-item" data-id="${lobby.id}">
                    <div class="lobby-info">
                        <div class="lobby-name">${lobby.name} ${lobby.locked ? '<span class="lobby-locked">&#128274;</span>' : ''}</div>
                        <div class="lobby-details">Host: ${lobby.host} | ${lobby.mode}</div>
                    </div>
                    <div class="lobby-players">
                        <span class="player-count">${lobby.players}/${lobby.max}</span>
                    </div>
                </div>
            `).join('');

            document.querySelectorAll('.lobby-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.lobby-item').forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    state.selectedLobby = item.dataset.id;
                    document.getElementById('joinLobby').disabled = false;
                });
            });
        }

        function createLobby() {
            state.isHost = true;
            joinLobby('new-lobby', 'New Game');
        }

        function joinSelectedLobby() {
            if (state.selectedLobby) {
                state.isHost = false;
                joinLobby(state.selectedLobby, 'Game Lobby');
            }
        }

        function joinLobby(lobbyId, name) {
            state.inLobby = true;
            state.isReady = false;

            document.getElementById('lobbyTitle').textContent = name;
            document.getElementById('lobbyCode').textContent = generateCode();

            elements.startGame.style.display = state.isHost ? 'block' : 'none';
            elements.readyBtn.textContent = 'Ready';
            elements.readyBtn.classList.remove('btn-danger');
            elements.readyBtn.classList.add('btn-success');

            // Disable settings for non-hosts
            document.querySelectorAll('#lobbySettings select').forEach(select => {
                select.disabled = !state.isHost;
            });

            showPanel('lobbyPanel');
            updatePlayerList();
        }

        function toggleReady() {
            state.isReady = !state.isReady;

            if (state.isReady) {
                elements.readyBtn.textContent = 'Not Ready';
                elements.readyBtn.classList.remove('btn-success');
                elements.readyBtn.classList.add('btn-danger');
            } else {
                elements.readyBtn.textContent = 'Ready';
                elements.readyBtn.classList.remove('btn-danger');
                elements.readyBtn.classList.add('btn-success');
            }
        }

        function leaveLobby() {
            state.inLobby = false;
            state.isHost = false;
            showPanel('modePanel');
        }

        function copyInviteCode() {
            const code = document.getElementById('lobbyCode').textContent;
            navigator.clipboard.writeText(code);
            // Show feedback
        }

        function generateCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars[Math.floor(Math.random() * chars.length)];
            }
            return code;
        }

        function updatePlayerList() {
            // Simulated players
            const team1 = [
                { name: 'You', rating: 1500, isHost: state.isHost, ready: state.isReady }
            ];
            const team2 = [];

            renderTeam('team1Players', team1, 4);
            renderTeam('team2Players', team2, 4);
        }

        function renderTeam(containerId, players, maxSlots) {
            const container = document.getElementById(containerId);
            let html = '';

            for (let i = 0; i < maxSlots; i++) {
                if (players[i]) {
                    const p = players[i];
                    html += `
                        <div class="player-card">
                            <div class="player-avatar">${p.name[0]}</div>
                            <div class="player-info">
                                <div class="player-name ${p.isHost ? 'host' : ''}">${p.name}</div>
                                <div class="player-rating">MMR: ${p.rating}</div>
                            </div>
                            <div class="ready-indicator ${p.ready ? 'ready' : ''}"></div>
                        </div>
                    `;
                } else {
                    html += '<div class="empty-slot">Empty Slot</div>';
                }
            }

            container.innerHTML = html;
        }

        function showReadyCheck() {
            elements.readyCheckOverlay.classList.add('active');
            let countdown = 10;

            const interval = setInterval(() => {
                countdown--;
                document.getElementById('readyCheckCountdown').textContent = countdown;

                if (countdown <= 0) {
                    clearInterval(interval);
                    elements.readyCheckOverlay.classList.remove('active');
                }
            }, 1000);
        }

        function confirmReadyCheck() {
            elements.readyCheckOverlay.classList.remove('active');
        }

        function showError(message) {
            elements.errorMessage.textContent = message;
            elements.errorMessage.classList.add('active');
            setTimeout(() => {
                elements.errorMessage.classList.remove('active');
            }, 5000);
        }

        // Bridge for C++ communication
        window.MatchmakingBridge = {
            onMatchFound: showMatchFound,
            onLobbyJoined: joinLobby,
            onPlayerJoined: updatePlayerList,
            onPlayerLeft: updatePlayerList,
            onReadyCheck: showReadyCheck,
            onError: showError,

            getState: () => ({
                mode: state.mode,
                isReady: state.isReady,
                isSearching: state.searching
            }),

            setSearchProgress: (progress) => {
                document.getElementById('playersInQueue').textContent = progress.playersInQueue;
                document.getElementById('estimatedWait').textContent = progress.estimatedWait;
            },

            updatePlayers: (players) => {
                state.players = players;
                updatePlayerList();
            }
        };

        // Initialize
        loadLobbies();
    </script>
</body>
</html>
