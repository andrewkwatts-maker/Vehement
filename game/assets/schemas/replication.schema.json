{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://old3dengine.com/schemas/replication.schema.json",
  "title": "Network Replication Schema",
  "description": "Schema for network replication configuration and entity definitions",
  "type": "object",
  "definitions": {
    "replicatedProperty": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Property name"
        },
        "type": {
          "type": "string",
          "enum": ["bool", "int8", "int16", "int32", "int64", "uint8", "uint16", "uint32", "uint64", "float", "double", "string", "vector2", "vector3", "quaternion", "color", "array", "object"],
          "description": "Property data type"
        },
        "replicationMode": {
          "type": "string",
          "enum": ["always", "onchange", "initial", "never"],
          "default": "onchange",
          "description": "When to replicate this property"
        },
        "interpolation": {
          "type": "string",
          "enum": ["none", "linear", "smooth", "snap"],
          "default": "none",
          "description": "Interpolation method for smooth updates"
        },
        "compression": {
          "type": "string",
          "enum": ["none", "quantize", "delta", "huffman"],
          "default": "none",
          "description": "Compression method for bandwidth optimization"
        },
        "quantizationBits": {
          "type": "integer",
          "minimum": 1,
          "maximum": 32,
          "description": "Bits for quantized values"
        },
        "priority": {
          "type": "integer",
          "minimum": 0,
          "maximum": 255,
          "default": 128,
          "description": "Replication priority (higher = more important)"
        },
        "relevanceDistance": {
          "type": "number",
          "minimum": 0,
          "description": "Maximum distance for relevance checking"
        },
        "condition": {
          "type": "string",
          "description": "Conditional expression for selective replication"
        },
        "default": {
          "description": "Default value for this property"
        }
      },
      "required": ["name", "type"]
    },
    "rpcDefinition": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "RPC function name"
        },
        "authority": {
          "type": "string",
          "enum": ["server", "client", "owner", "any"],
          "default": "server",
          "description": "Who can call this RPC"
        },
        "target": {
          "type": "string",
          "enum": ["server", "owner", "all_clients", "all_except_owner", "multicast"],
          "default": "server",
          "description": "Who receives this RPC"
        },
        "reliable": {
          "type": "boolean",
          "default": true,
          "description": "Whether RPC delivery is guaranteed"
        },
        "parameters": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "type": { "type": "string" }
            },
            "required": ["name", "type"]
          }
        },
        "validation": {
          "type": "string",
          "description": "Server-side validation expression"
        },
        "rateLimit": {
          "type": "number",
          "description": "Maximum calls per second"
        }
      },
      "required": ["name"]
    },
    "entityDefinition": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Entity class name"
        },
        "extends": {
          "type": "string",
          "description": "Parent entity class"
        },
        "networkId": {
          "type": "integer",
          "minimum": 1,
          "description": "Unique network type identifier"
        },
        "relevanceMode": {
          "type": "string",
          "enum": ["always", "distance", "owner_only", "team", "custom"],
          "default": "always",
          "description": "How relevance is determined for clients"
        },
        "relevanceRadius": {
          "type": "number",
          "minimum": 0,
          "description": "Radius for distance-based relevance"
        },
        "dormancyEnabled": {
          "type": "boolean",
          "default": false,
          "description": "Whether entity can go dormant to save bandwidth"
        },
        "dormancyTimeout": {
          "type": "number",
          "description": "Seconds of inactivity before going dormant"
        },
        "snapshotRate": {
          "type": "number",
          "minimum": 1,
          "maximum": 128,
          "default": 20,
          "description": "Snapshots per second"
        },
        "properties": {
          "type": "array",
          "items": { "$ref": "#/definitions/replicatedProperty" }
        },
        "rpcs": {
          "type": "array",
          "items": { "$ref": "#/definitions/rpcDefinition" }
        },
        "groups": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "properties": { "type": "array", "items": { "type": "string" } },
              "condition": { "type": "string" }
            }
          },
          "description": "Property groups for conditional replication"
        }
      },
      "required": ["name", "networkId"]
    },
    "channelDefinition": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Channel name"
        },
        "id": {
          "type": "integer",
          "minimum": 0,
          "maximum": 255,
          "description": "Channel ID"
        },
        "reliable": {
          "type": "boolean",
          "default": true,
          "description": "Whether channel guarantees delivery"
        },
        "ordered": {
          "type": "boolean",
          "default": true,
          "description": "Whether messages are ordered"
        },
        "priority": {
          "type": "integer",
          "minimum": 0,
          "maximum": 255,
          "default": 128,
          "description": "Channel priority for bandwidth allocation"
        },
        "maxBandwidth": {
          "type": "integer",
          "description": "Maximum bytes per second for this channel"
        }
      },
      "required": ["name", "id"]
    }
  },
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Schema version"
    },
    "entities": {
      "type": "array",
      "items": { "$ref": "#/definitions/entityDefinition" },
      "description": "Entity type definitions"
    },
    "channels": {
      "type": "array",
      "items": { "$ref": "#/definitions/channelDefinition" },
      "description": "Network channel definitions"
    },
    "globalSettings": {
      "type": "object",
      "properties": {
        "maxEntitiesPerClient": {
          "type": "integer",
          "default": 1000
        },
        "maxPropertiesPerEntity": {
          "type": "integer",
          "default": 256
        },
        "defaultSnapshotRate": {
          "type": "number",
          "default": 20
        },
        "defaultRelevanceRadius": {
          "type": "number",
          "default": 1000
        },
        "compressionEnabled": {
          "type": "boolean",
          "default": true
        },
        "deltaCompressionEnabled": {
          "type": "boolean",
          "default": true
        }
      }
    }
  },
  "required": ["version", "entities"]
}
