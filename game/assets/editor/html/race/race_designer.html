<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Designer - Vehement RTS</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --bg-color: #1a1a2e;
            --panel-color: #16213e;
            --text-color: #ecf0f1;
            --border-color: #34495e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: grid;
            grid-template-rows: auto 1fr auto;
            height: 100vh;
        }

        /* Header */
        .header {
            background-color: var(--panel-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border-color);
        }

        .header h1 {
            font-size: 1.5rem;
            color: var(--secondary-color);
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #219a52;
        }

        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 200px 1fr 300px;
            overflow: hidden;
        }

        /* Sidebar Navigation */
        .sidebar {
            background-color: var(--panel-color);
            border-right: 2px solid var(--border-color);
            padding: 10px;
        }

        .nav-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-item:hover {
            background-color: rgba(52, 152, 219, 0.2);
        }

        .nav-item.active {
            background-color: var(--secondary-color);
        }

        /* Editor Panel */
        .editor-panel {
            padding: 20px;
            overflow-y: auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            background-color: var(--panel-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section h2 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        /* Point Allocation */
        .point-allocation {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .point-category {
            background-color: var(--bg-color);
            border-radius: 8px;
            padding: 15px;
        }

        .point-category h3 {
            font-size: 1rem;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .point-value {
            background-color: var(--secondary-color);
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .slider-container {
            margin-bottom: 10px;
        }

        .slider-container label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .slider-container input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: var(--border-color);
            outline: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--secondary-color);
            cursor: pointer;
        }

        /* Archetype List */
        .archetype-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        .archetype-card {
            background-color: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .archetype-card:hover {
            border-color: var(--secondary-color);
        }

        .archetype-card.selected {
            border-color: var(--success-color);
            background-color: rgba(39, 174, 96, 0.1);
        }

        .archetype-card .icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .archetype-card .name {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .archetype-card .cost {
            font-size: 0.75rem;
            color: var(--warning-color);
            margin-top: 5px;
        }

        /* Properties Panel */
        .properties-panel {
            background-color: var(--panel-color);
            border-left: 2px solid var(--border-color);
            padding: 15px;
            overflow-y: auto;
        }

        .properties-panel h2 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }

        .property-group {
            margin-bottom: 15px;
        }

        .property-group h3 {
            font-size: 0.9rem;
            margin-bottom: 10px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.85rem;
        }

        .stat-row .value {
            color: var(--secondary-color);
        }

        .stat-row .value.positive {
            color: var(--success-color);
        }

        .stat-row .value.negative {
            color: var(--accent-color);
        }

        /* Balance Meter */
        .balance-meter {
            margin-top: 20px;
        }

        .balance-bar {
            height: 20px;
            background-color: var(--bg-color);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .balance-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--warning-color), var(--success-color));
            transition: width 0.3s ease;
        }

        .balance-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-top: 5px;
        }

        /* Warnings */
        .warning-list {
            margin-top: 20px;
        }

        .warning-item {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .warning-item.minor {
            background-color: rgba(243, 156, 18, 0.2);
            border-left: 3px solid var(--warning-color);
        }

        .warning-item.major {
            background-color: rgba(231, 76, 60, 0.2);
            border-left: 3px solid var(--accent-color);
        }

        .warning-item.critical {
            background-color: rgba(231, 76, 60, 0.4);
            border-left: 3px solid var(--accent-color);
        }

        /* Footer */
        .footer {
            background-color: var(--panel-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 2px solid var(--border-color);
        }

        .footer-info {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .footer-status {
            display: flex;
            gap: 20px;
            font-size: 0.85rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-dot.valid {
            background-color: var(--success-color);
        }

        .status-dot.warning {
            background-color: var(--warning-color);
        }

        .status-dot.invalid {
            background-color: var(--accent-color);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--panel-color);
            border-radius: 8px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: var(--secondary-color);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Template Selection */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .template-card {
            background-color: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            border-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .template-card.selected {
            border-color: var(--success-color);
        }

        .template-card .icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .template-card .name {
            font-weight: 500;
        }

        .template-card .description {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Race Designer</h1>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="newRace()">New Race</button>
                <button class="btn btn-primary" onclick="loadRace()">Load</button>
                <button class="btn btn-success" onclick="saveRace()">Save</button>
                <button class="btn btn-primary" onclick="exportRace()">Export JSON</button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <nav class="sidebar">
                <div class="nav-item active" data-tab="overview">Overview</div>
                <div class="nav-item" data-tab="points">Point Allocation</div>
                <div class="nav-item" data-tab="units">Unit Archetypes</div>
                <div class="nav-item" data-tab="buildings">Building Archetypes</div>
                <div class="nav-item" data-tab="heroes">Hero Archetypes</div>
                <div class="nav-item" data-tab="spells">Spell Archetypes</div>
                <div class="nav-item" data-tab="bonuses">Racial Bonuses</div>
                <div class="nav-item" data-tab="talents">Talent Tree</div>
                <div class="nav-item" data-tab="preview">Preview</div>
            </nav>

            <!-- Editor Panel -->
            <main class="editor-panel">
                <!-- Overview Tab -->
                <div class="tab-content active" id="tab-overview">
                    <div class="section">
                        <h2>Race Information</h2>
                        <div class="form-group">
                            <label for="race-name">Race Name</label>
                            <input type="text" id="race-name" placeholder="Enter race name...">
                        </div>
                        <div class="form-group">
                            <label for="race-id">Race ID</label>
                            <input type="text" id="race-id" placeholder="unique_race_id">
                        </div>
                        <div class="form-group">
                            <label for="race-theme">Theme</label>
                            <select id="race-theme">
                                <option value="fantasy">Fantasy</option>
                                <option value="scifi">Sci-Fi</option>
                                <option value="horror">Horror</option>
                                <option value="nature">Nature</option>
                                <option value="steampunk">Steampunk</option>
                                <option value="mystical">Mystical</option>
                                <option value="tribal">Tribal</option>
                                <option value="imperial">Imperial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="race-description">Description</label>
                            <textarea id="race-description" rows="4" placeholder="Describe your race..."></textarea>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Quick Templates</h2>
                        <div class="template-grid">
                            <div class="template-card" onclick="loadTemplate('human')">
                                <div class="icon">&#9812;</div>
                                <div class="name">Human</div>
                                <div class="description">Balanced, versatile</div>
                            </div>
                            <div class="template-card" onclick="loadTemplate('orc')">
                                <div class="icon">&#9876;</div>
                                <div class="name">Orc</div>
                                <div class="description">Military focused</div>
                            </div>
                            <div class="template-card" onclick="loadTemplate('elf')">
                                <div class="icon">&#9733;</div>
                                <div class="name">Elf</div>
                                <div class="description">Magic focused</div>
                            </div>
                            <div class="template-card" onclick="loadTemplate('undead')">
                                <div class="icon">&#9760;</div>
                                <div class="name">Undead</div>
                                <div class="description">Unique mechanics</div>
                            </div>
                            <div class="template-card" onclick="loadTemplate('dwarf')">
                                <div class="icon">&#9881;</div>
                                <div class="name">Dwarf</div>
                                <div class="description">Defense focused</div>
                            </div>
                            <div class="template-card" onclick="loadTemplate('blank')">
                                <div class="icon">&#10133;</div>
                                <div class="name">Blank</div>
                                <div class="description">Start from scratch</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Point Allocation Tab -->
                <div class="tab-content" id="tab-points">
                    <div class="section">
                        <h2>Point Allocation (100 Total Points)</h2>
                        <div class="point-allocation">
                            <div class="point-category" id="military-category">
                                <h3>Military <span class="point-value" id="military-points">25</span></h3>
                                <div class="slider-container">
                                    <label>Infantry <span id="infantry-value">25</span>%</label>
                                    <input type="range" id="infantry-slider" min="0" max="100" value="25" oninput="updateMilitaryAllocation()">
                                </div>
                                <div class="slider-container">
                                    <label>Ranged <span id="ranged-value">25</span>%</label>
                                    <input type="range" id="ranged-slider" min="0" max="100" value="25" oninput="updateMilitaryAllocation()">
                                </div>
                                <div class="slider-container">
                                    <label>Cavalry <span id="cavalry-value">25</span>%</label>
                                    <input type="range" id="cavalry-slider" min="0" max="100" value="25" oninput="updateMilitaryAllocation()">
                                </div>
                                <div class="slider-container">
                                    <label>Siege <span id="siege-value">25</span>%</label>
                                    <input type="range" id="siege-slider" min="0" max="100" value="25" oninput="updateMilitaryAllocation()">
                                </div>
                            </div>

                            <div class="point-category" id="economy-category">
                                <h3>Economy <span class="point-value" id="economy-points">25</span></h3>
                                <div class="slider-container">
                                    <label>Harvest Speed <span id="harvest-value">25</span>%</label>
                                    <input type="range" id="harvest-slider" min="0" max="100" value="25" oninput="updateEconomyAllocation()">
                                </div>
                                <div class="slider-container">
                                    <label>Build Speed <span id="build-value">25</span>%</label>
                                    <input type="range" id="build-slider" min="0" max="100" value="25" oninput="updateEconomyAllocation()">
                                </div>
                                <div class="slider-container">
                                    <label>Carry Capacity <span id="carry-value">25</span>%</label>
                                    <input type="range" id="carry-slider" min="0" max="100" value="25" oninput="updateEconomyAllocation()">
                                </div>
                                <div class="slider-container">
                                    <label>Trade Profits <span id="trade-value">25</span>%</label>
                                    <input type="range" id="trade-slider" min="0" max="100" value="25" oninput="updateEconomyAllocation()">
                                </div>
                            </div>

                            <div class="point-category" id="magic-category">
                                <h3>Magic <span class="point-value" id="magic-points">25</span></h3>
                                <div class="slider-container">
                                    <label>Spell Damage <span id="spelldmg-value">25</span>%</label>
                                    <input type="range" id="spelldmg-slider" min="0" max="100" value="25" oninput="updateMagicAllocation()">
                                </div>
                                <div class="slider-container">
                                    <label>Spell Range <span id="spellrange-value">25</span>%</label>
                                    <input type="range" id="spellrange-slider" min="0" max="100" value="25" oninput="updateMagicAllocation()">
                                </div>
                                <div class="slider-container">
                                    <label>Mana Efficiency <span id="mana-value">25</span>%</label>
                                    <input type="range" id="mana-slider" min="0" max="100" value="25" oninput="updateMagicAllocation()">
                                </div>
                                <div class="slider-container">
                                    <label>Cooldown Reduction <span id="cooldown-value">25</span>%</label>
                                    <input type="range" id="cooldown-slider" min="0" max="100" value="25" oninput="updateMagicAllocation()">
                                </div>
                            </div>

                            <div class="point-category" id="tech-category">
                                <h3>Technology <span class="point-value" id="tech-points">25</span></h3>
                                <div class="slider-container">
                                    <label>Research Speed <span id="research-value">40</span>%</label>
                                    <input type="range" id="research-slider" min="0" max="100" value="40" oninput="updateTechAllocation()">
                                </div>
                                <div class="slider-container">
                                    <label>Age Up Cost <span id="ageup-value">30</span>%</label>
                                    <input type="range" id="ageup-slider" min="0" max="100" value="30" oninput="updateTechAllocation()">
                                </div>
                                <div class="slider-container">
                                    <label>Unique Techs <span id="unique-value">30</span>%</label>
                                    <input type="range" id="unique-slider" min="0" max="100" value="30" oninput="updateTechAllocation()">
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="autoBalance()">Auto Balance</button>
                            <button class="btn btn-primary" onclick="applyPreset('balanced')">Balanced Preset</button>
                            <button class="btn btn-primary" onclick="applyPreset('military')">Military Preset</button>
                            <button class="btn btn-primary" onclick="applyPreset('economy')">Economy Preset</button>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Main Category Allocation</h2>
                        <div class="slider-container">
                            <label>Military <span id="main-military-value">25</span></label>
                            <input type="range" id="main-military-slider" min="0" max="100" value="25" oninput="updateMainAllocation()">
                        </div>
                        <div class="slider-container">
                            <label>Economy <span id="main-economy-value">25</span></label>
                            <input type="range" id="main-economy-slider" min="0" max="100" value="25" oninput="updateMainAllocation()">
                        </div>
                        <div class="slider-container">
                            <label>Magic <span id="main-magic-value">25</span></label>
                            <input type="range" id="main-magic-slider" min="0" max="100" value="25" oninput="updateMainAllocation()">
                        </div>
                        <div class="slider-container">
                            <label>Technology <span id="main-tech-value">25</span></label>
                            <input type="range" id="main-tech-slider" min="0" max="100" value="25" oninput="updateMainAllocation()">
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9rem;">
                            Total: <span id="total-points">100</span> / 100
                        </div>
                    </div>
                </div>

                <!-- Unit Archetypes Tab -->
                <div class="tab-content" id="tab-units">
                    <div class="section">
                        <h2>Select Unit Archetypes</h2>
                        <div class="archetype-list" id="unit-archetype-list">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Building Archetypes Tab -->
                <div class="tab-content" id="tab-buildings">
                    <div class="section">
                        <h2>Select Building Archetypes</h2>
                        <div class="archetype-list" id="building-archetype-list">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Hero Archetypes Tab -->
                <div class="tab-content" id="tab-heroes">
                    <div class="section">
                        <h2>Select Hero Archetypes</h2>
                        <div class="archetype-list" id="hero-archetype-list">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Spell Archetypes Tab -->
                <div class="tab-content" id="tab-spells">
                    <div class="section">
                        <h2>Select Spell Archetypes</h2>
                        <div class="archetype-list" id="spell-archetype-list">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Bonuses Tab -->
                <div class="tab-content" id="tab-bonuses">
                    <div class="section">
                        <h2>Racial Bonuses</h2>
                        <p style="margin-bottom: 15px; opacity: 0.8;">Select bonuses for your race. Each bonus has a point cost.</p>
                        <div class="archetype-list" id="bonus-list">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Talent Tree Tab -->
                <div class="tab-content" id="tab-talents">
                    <div class="section">
                        <h2>Talent Tree</h2>
                        <p style="margin-bottom: 15px;">Configure the talent tree for this race.</p>
                        <button class="btn btn-primary" onclick="openTalentTreeEditor()">Open Talent Tree Editor</button>
                        <div id="talent-tree-preview" style="margin-top: 20px; min-height: 300px; background-color: var(--bg-color); border-radius: 8px; padding: 20px;">
                            <p style="text-align: center; opacity: 0.5;">Talent tree preview will appear here</p>
                        </div>
                    </div>
                </div>

                <!-- Preview Tab -->
                <div class="tab-content" id="tab-preview">
                    <div class="section">
                        <h2>Race Preview</h2>
                        <div id="race-preview-content">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>
            </main>

            <!-- Properties Panel -->
            <aside class="properties-panel">
                <h2>Race Statistics</h2>

                <div class="property-group">
                    <h3>Power Level</h3>
                    <div class="stat-row">
                        <span>Overall Power</span>
                        <span class="value" id="power-level">1.00</span>
                    </div>
                    <div class="stat-row">
                        <span>Military Strength</span>
                        <span class="value" id="military-strength">1.00</span>
                    </div>
                    <div class="stat-row">
                        <span>Economic Power</span>
                        <span class="value" id="economic-power">1.00</span>
                    </div>
                    <div class="stat-row">
                        <span>Magic Power</span>
                        <span class="value" id="magic-power">1.00</span>
                    </div>
                    <div class="stat-row">
                        <span>Tech Level</span>
                        <span class="value" id="tech-level">1.00</span>
                    </div>
                </div>

                <div class="property-group">
                    <h3>Bonuses Applied</h3>
                    <div id="applied-bonuses">
                        <div class="stat-row">
                            <span>Infantry Damage</span>
                            <span class="value positive">+0%</span>
                        </div>
                        <div class="stat-row">
                            <span>Harvest Speed</span>
                            <span class="value positive">+0%</span>
                        </div>
                    </div>
                </div>

                <div class="balance-meter">
                    <h3>Balance Score</h3>
                    <div class="balance-bar">
                        <div class="balance-fill" id="balance-fill" style="width: 50%;"></div>
                    </div>
                    <div class="balance-label">
                        <span>Underpowered</span>
                        <span>Balanced</span>
                        <span>Overpowered</span>
                    </div>
                </div>

                <div class="warning-list" id="warning-list">
                    <!-- Dynamically populated -->
                </div>
            </aside>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-info">
                <span>Race Designer v1.0</span>
            </div>
            <div class="footer-status">
                <div class="status-indicator">
                    <span class="status-dot valid" id="status-dot"></span>
                    <span id="status-text">Valid</span>
                </div>
                <div class="status-indicator">
                    <span>Modified: </span>
                    <span id="modified-status">No</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- New Race Modal -->
    <div class="modal" id="new-race-modal">
        <div class="modal-content">
            <h2>Create New Race</h2>
            <div class="form-group">
                <label>Start from Template</label>
                <select id="template-select">
                    <option value="blank">Blank Race</option>
                    <option value="human">Human Template</option>
                    <option value="orc">Orc Template</option>
                    <option value="elf">Elf Template</option>
                    <option value="undead">Undead Template</option>
                    <option value="dwarf">Dwarf Template</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="closeModal('new-race-modal')">Cancel</button>
                <button class="btn btn-success" onclick="createNewRace()">Create</button>
            </div>
        </div>
    </div>

    <script>
        // Race Designer JavaScript

        // State
        let currentRace = {
            id: '',
            name: '',
            theme: 'fantasy',
            description: '',
            allocation: {
                military: 25,
                economy: 25,
                magic: 25,
                technology: 25,
                militarySub: { infantry: 25, ranged: 25, cavalry: 25, siege: 25 },
                economySub: { harvest: 25, build: 25, carry: 25, trade: 25 },
                magicSub: { damage: 25, range: 25, mana: 25, cooldown: 25 },
                techSub: { research: 40, ageUp: 30, unique: 30 }
            },
            unitArchetypes: [],
            buildingArchetypes: [],
            heroArchetypes: [],
            spellArchetypes: [],
            bonuses: []
        };

        let isDirty = false;

        // Available archetypes (would be loaded from C++ bridge)
        const availableUnits = [
            { id: 'worker', name: 'Worker', icon: '&#9935;', cost: 0 },
            { id: 'militia', name: 'Militia', icon: '&#9876;', cost: 5 },
            { id: 'infantry', name: 'Infantry', icon: '&#9876;', cost: 10 },
            { id: 'archer', name: 'Archer', icon: '&#127993;', cost: 10 },
            { id: 'cavalry', name: 'Cavalry', icon: '&#9816;', cost: 15 },
            { id: 'siege', name: 'Siege Engine', icon: '&#9881;', cost: 20 },
            { id: 'naval', name: 'Naval Unit', icon: '&#9875;', cost: 15 },
            { id: 'air', name: 'Air Unit', icon: '&#9992;', cost: 25 }
        ];

        const availableBuildings = [
            { id: 'main_hall', name: 'Main Hall', icon: '&#127984;', cost: 0 },
            { id: 'barracks', name: 'Barracks', icon: '&#127970;', cost: 10 },
            { id: 'tower', name: 'Tower', icon: '&#127960;', cost: 10 },
            { id: 'wall', name: 'Wall', icon: '&#9632;', cost: 5 },
            { id: 'farm', name: 'Farm', icon: '&#127806;', cost: 5 },
            { id: 'mine', name: 'Mine', icon: '&#9935;', cost: 10 },
            { id: 'market', name: 'Market', icon: '&#128176;', cost: 15 },
            { id: 'temple', name: 'Temple', icon: '&#9961;', cost: 20 }
        ];

        const availableHeroes = [
            { id: 'warrior', name: 'Warrior', icon: '&#9876;', cost: 20 },
            { id: 'mage', name: 'Mage', icon: '&#9733;', cost: 20 },
            { id: 'ranger', name: 'Ranger', icon: '&#127993;', cost: 20 },
            { id: 'support', name: 'Support', icon: '&#10010;', cost: 15 },
            { id: 'specialist', name: 'Specialist', icon: '&#9881;', cost: 25 }
        ];

        const availableSpells = [
            { id: 'fireball', name: 'Fireball', icon: '&#128293;', cost: 10 },
            { id: 'blizzard', name: 'Blizzard', icon: '&#10052;', cost: 15 },
            { id: 'heal', name: 'Heal', icon: '&#10010;', cost: 10 },
            { id: 'bloodlust', name: 'Bloodlust', icon: '&#128165;', cost: 15 },
            { id: 'summon', name: 'Summon', icon: '&#9760;', cost: 20 },
            { id: 'teleport', name: 'Teleport', icon: '&#10024;', cost: 25 }
        ];

        const availableBonuses = [
            { id: 'gather_speed', name: 'Gather Speed +10%', cost: 10 },
            { id: 'build_speed', name: 'Build Speed +15%', cost: 12 },
            { id: 'infantry_damage', name: 'Infantry Damage +10%', cost: 15 },
            { id: 'cavalry_speed', name: 'Cavalry Speed +10%', cost: 12 },
            { id: 'spell_damage', name: 'Spell Damage +15%', cost: 18 },
            { id: 'research_speed', name: 'Research Speed +20%', cost: 15 }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeTabs();
            populateArchetypeLists();
            updateUI();
        });

        function initializeTabs() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const tabId = item.dataset.tab;
                    switchTab(tabId);
                });
            });
        }

        function switchTab(tabId) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.tab === tabId) {
                    item.classList.add('active');
                }
            });

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.getElementById('tab-' + tabId).classList.add('active');
        }

        function populateArchetypeLists() {
            populateList('unit-archetype-list', availableUnits, 'unitArchetypes');
            populateList('building-archetype-list', availableBuildings, 'buildingArchetypes');
            populateList('hero-archetype-list', availableHeroes, 'heroArchetypes');
            populateList('spell-archetype-list', availableSpells, 'spellArchetypes');
            populateBonusList();
        }

        function populateList(containerId, items, archetypeType) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'archetype-card';
                card.dataset.id = item.id;
                card.innerHTML = `
                    <div class="icon">${item.icon}</div>
                    <div class="name">${item.name}</div>
                    <div class="cost">${item.cost} points</div>
                `;
                card.addEventListener('click', () => toggleArchetype(card, item.id, archetypeType));
                container.appendChild(card);
            });
        }

        function populateBonusList() {
            const container = document.getElementById('bonus-list');
            container.innerHTML = '';

            availableBonuses.forEach(bonus => {
                const card = document.createElement('div');
                card.className = 'archetype-card';
                card.dataset.id = bonus.id;
                card.innerHTML = `
                    <div class="name">${bonus.name}</div>
                    <div class="cost">${bonus.cost} points</div>
                `;
                card.addEventListener('click', () => toggleBonus(card, bonus.id));
                container.appendChild(card);
            });
        }

        function toggleArchetype(card, id, archetypeType) {
            const array = currentRace[archetypeType];
            const index = array.indexOf(id);

            if (index === -1) {
                array.push(id);
                card.classList.add('selected');
            } else {
                array.splice(index, 1);
                card.classList.remove('selected');
            }

            markDirty();
            updateUI();
        }

        function toggleBonus(card, id) {
            const index = currentRace.bonuses.indexOf(id);

            if (index === -1) {
                currentRace.bonuses.push(id);
                card.classList.add('selected');
            } else {
                currentRace.bonuses.splice(index, 1);
                card.classList.remove('selected');
            }

            markDirty();
            updateUI();
        }

        function updateMainAllocation() {
            const military = parseInt(document.getElementById('main-military-slider').value);
            const economy = parseInt(document.getElementById('main-economy-slider').value);
            const magic = parseInt(document.getElementById('main-magic-slider').value);
            const tech = parseInt(document.getElementById('main-tech-slider').value);

            document.getElementById('main-military-value').textContent = military;
            document.getElementById('main-economy-value').textContent = economy;
            document.getElementById('main-magic-value').textContent = magic;
            document.getElementById('main-tech-value').textContent = tech;

            const total = military + economy + magic + tech;
            document.getElementById('total-points').textContent = total;

            currentRace.allocation.military = military;
            currentRace.allocation.economy = economy;
            currentRace.allocation.magic = magic;
            currentRace.allocation.technology = tech;

            document.getElementById('military-points').textContent = military;
            document.getElementById('economy-points').textContent = economy;
            document.getElementById('magic-points').textContent = magic;
            document.getElementById('tech-points').textContent = tech;

            markDirty();
            updateUI();
        }

        function updateMilitaryAllocation() {
            const infantry = parseInt(document.getElementById('infantry-slider').value);
            const ranged = parseInt(document.getElementById('ranged-slider').value);
            const cavalry = parseInt(document.getElementById('cavalry-slider').value);
            const siege = parseInt(document.getElementById('siege-slider').value);

            document.getElementById('infantry-value').textContent = infantry;
            document.getElementById('ranged-value').textContent = ranged;
            document.getElementById('cavalry-value').textContent = cavalry;
            document.getElementById('siege-value').textContent = siege;

            currentRace.allocation.militarySub = { infantry, ranged, cavalry, siege };
            markDirty();
            updateUI();
        }

        function updateEconomyAllocation() {
            const harvest = parseInt(document.getElementById('harvest-slider').value);
            const build = parseInt(document.getElementById('build-slider').value);
            const carry = parseInt(document.getElementById('carry-slider').value);
            const trade = parseInt(document.getElementById('trade-slider').value);

            document.getElementById('harvest-value').textContent = harvest;
            document.getElementById('build-value').textContent = build;
            document.getElementById('carry-value').textContent = carry;
            document.getElementById('trade-value').textContent = trade;

            currentRace.allocation.economySub = { harvest, build, carry, trade };
            markDirty();
            updateUI();
        }

        function updateMagicAllocation() {
            const damage = parseInt(document.getElementById('spelldmg-slider').value);
            const range = parseInt(document.getElementById('spellrange-slider').value);
            const mana = parseInt(document.getElementById('mana-slider').value);
            const cooldown = parseInt(document.getElementById('cooldown-slider').value);

            document.getElementById('spelldmg-value').textContent = damage;
            document.getElementById('spellrange-value').textContent = range;
            document.getElementById('mana-value').textContent = mana;
            document.getElementById('cooldown-value').textContent = cooldown;

            currentRace.allocation.magicSub = { damage, range, mana, cooldown };
            markDirty();
            updateUI();
        }

        function updateTechAllocation() {
            const research = parseInt(document.getElementById('research-slider').value);
            const ageUp = parseInt(document.getElementById('ageup-slider').value);
            const unique = parseInt(document.getElementById('unique-slider').value);

            document.getElementById('research-value').textContent = research;
            document.getElementById('ageup-value').textContent = ageUp;
            document.getElementById('unique-value').textContent = unique;

            currentRace.allocation.techSub = { research, ageUp, unique };
            markDirty();
            updateUI();
        }

        function updateUI() {
            // Update power levels
            const powerLevel = calculatePowerLevel();
            document.getElementById('power-level').textContent = powerLevel.overall.toFixed(2);
            document.getElementById('military-strength').textContent = powerLevel.military.toFixed(2);
            document.getElementById('economic-power').textContent = powerLevel.economy.toFixed(2);
            document.getElementById('magic-power').textContent = powerLevel.magic.toFixed(2);
            document.getElementById('tech-level').textContent = powerLevel.tech.toFixed(2);

            // Update balance meter
            const balanceScore = calculateBalanceScore();
            const balancePercent = Math.min(100, Math.max(0, (balanceScore + 1) * 50));
            document.getElementById('balance-fill').style.width = balancePercent + '%';

            // Update warnings
            updateWarnings();

            // Update status
            updateStatus();
        }

        function calculatePowerLevel() {
            const a = currentRace.allocation;
            return {
                overall: (a.military + a.economy + a.magic + a.technology) / 100,
                military: a.military / 25,
                economy: a.economy / 25,
                magic: a.magic / 25,
                tech: a.technology / 25
            };
        }

        function calculateBalanceScore() {
            const a = currentRace.allocation;
            const values = [a.military, a.economy, a.magic, a.technology];
            const avg = values.reduce((s, v) => s + v, 0) / 4;
            const variance = values.reduce((s, v) => s + Math.pow(v - avg, 2), 0) / 4;
            return 1 - (Math.sqrt(variance) / 25);
        }

        function updateWarnings() {
            const container = document.getElementById('warning-list');
            container.innerHTML = '<h3>Warnings</h3>';

            const warnings = getValidationWarnings();
            warnings.forEach(warning => {
                const div = document.createElement('div');
                div.className = `warning-item ${warning.severity}`;
                div.textContent = warning.message;
                container.appendChild(div);
            });

            if (warnings.length === 0) {
                const div = document.createElement('div');
                div.style.opacity = '0.5';
                div.style.fontSize = '0.85rem';
                div.style.marginTop = '10px';
                div.textContent = 'No warnings';
                container.appendChild(div);
            }
        }

        function getValidationWarnings() {
            const warnings = [];
            const a = currentRace.allocation;
            const total = a.military + a.economy + a.magic + a.technology;

            if (total !== 100) {
                warnings.push({
                    severity: 'major',
                    message: `Total points must equal 100 (currently ${total})`
                });
            }

            if (a.military > 50) {
                warnings.push({
                    severity: 'minor',
                    message: 'High military allocation may cause balance issues'
                });
            }

            if (a.economy < 10) {
                warnings.push({
                    severity: 'minor',
                    message: 'Low economy may cause resource problems'
                });
            }

            if (currentRace.unitArchetypes.length === 0) {
                warnings.push({
                    severity: 'major',
                    message: 'No unit archetypes selected'
                });
            }

            if (currentRace.buildingArchetypes.length === 0) {
                warnings.push({
                    severity: 'major',
                    message: 'No building archetypes selected'
                });
            }

            return warnings;
        }

        function updateStatus() {
            const warnings = getValidationWarnings();
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');

            if (warnings.some(w => w.severity === 'major' || w.severity === 'critical')) {
                statusDot.className = 'status-dot invalid';
                statusText.textContent = 'Invalid';
            } else if (warnings.length > 0) {
                statusDot.className = 'status-dot warning';
                statusText.textContent = 'Warnings';
            } else {
                statusDot.className = 'status-dot valid';
                statusText.textContent = 'Valid';
            }

            document.getElementById('modified-status').textContent = isDirty ? 'Yes' : 'No';
        }

        function markDirty() {
            isDirty = true;
        }

        // Actions
        function newRace() {
            document.getElementById('new-race-modal').classList.add('active');
        }

        function createNewRace() {
            const template = document.getElementById('template-select').value;
            loadTemplate(template);
            closeModal('new-race-modal');
        }

        function loadTemplate(templateName) {
            // Load template from C++ bridge or use defaults
            const templates = {
                blank: { military: 25, economy: 25, magic: 25, technology: 25 },
                human: { military: 25, economy: 25, magic: 25, technology: 25 },
                orc: { military: 40, economy: 20, magic: 15, technology: 25 },
                elf: { military: 20, economy: 20, magic: 40, technology: 20 },
                undead: { military: 30, economy: 15, magic: 35, technology: 20 },
                dwarf: { military: 30, economy: 30, magic: 10, technology: 30 }
            };

            const template = templates[templateName] || templates.blank;

            currentRace.allocation.military = template.military;
            currentRace.allocation.economy = template.economy;
            currentRace.allocation.magic = template.magic;
            currentRace.allocation.technology = template.technology;

            // Update sliders
            document.getElementById('main-military-slider').value = template.military;
            document.getElementById('main-economy-slider').value = template.economy;
            document.getElementById('main-magic-slider').value = template.magic;
            document.getElementById('main-tech-slider').value = template.technology;

            updateMainAllocation();
            markDirty();
        }

        function loadRace() {
            // Would call C++ bridge to open file dialog
            if (typeof RaceDesignerBridge !== 'undefined') {
                RaceDesignerBridge.loadRace();
            } else {
                alert('Load functionality requires C++ integration');
            }
        }

        function saveRace() {
            // Would call C++ bridge to save
            if (typeof RaceDesignerBridge !== 'undefined') {
                RaceDesignerBridge.saveRace(JSON.stringify(currentRace));
            } else {
                alert('Save functionality requires C++ integration');
            }
        }

        function exportRace() {
            const json = JSON.stringify(currentRace, null, 2);
            console.log(json);
            alert('Race JSON exported to console');
        }

        function autoBalance() {
            currentRace.allocation.military = 25;
            currentRace.allocation.economy = 25;
            currentRace.allocation.magic = 25;
            currentRace.allocation.technology = 25;

            document.getElementById('main-military-slider').value = 25;
            document.getElementById('main-economy-slider').value = 25;
            document.getElementById('main-magic-slider').value = 25;
            document.getElementById('main-tech-slider').value = 25;

            updateMainAllocation();
        }

        function applyPreset(preset) {
            const presets = {
                balanced: { military: 25, economy: 25, magic: 25, technology: 25 },
                military: { military: 40, economy: 20, magic: 20, technology: 20 },
                economy: { military: 20, economy: 40, magic: 20, technology: 20 }
            };

            const p = presets[preset];
            if (p) {
                document.getElementById('main-military-slider').value = p.military;
                document.getElementById('main-economy-slider').value = p.economy;
                document.getElementById('main-magic-slider').value = p.magic;
                document.getElementById('main-tech-slider').value = p.technology;
                updateMainAllocation();
            }
        }

        function openTalentTreeEditor() {
            // Open talent tree editor in new window or iframe
            window.open('talent_tree_editor.html', 'TalentTreeEditor', 'width=1200,height=800');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // C++ Bridge integration
        function setRaceFromCpp(jsonString) {
            currentRace = JSON.parse(jsonString);
            populateArchetypeLists();
            updateUI();
        }

        function getRaceJson() {
            return JSON.stringify(currentRace);
        }
    </script>
</body>
</html>
